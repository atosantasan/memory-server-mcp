# 実装計画

- [x] 1. プロジェクト構造とコア依存関係のセットアップ
  - requirements.txtファイルを作成し、必要なライブラリ（fastapi、uvicorn、fastmcp）を定義
  - main.pyファイルの基本構造を作成し、FastMCPとFastAPIの初期化コードを実装
  - _要件: 6.1, 6.4_

- [x] 2. データベーススキーマとデータモデルの実装
  - [x] 2.1 SQLiteデータベーススキーマの作成
    - memory_entriesテーブルの定義とインデックス作成のSQLを実装
    - データベース初期化関数を作成し、テーブルが存在しない場合の自動作成機能を実装
    - _要件: 1.4, 7.2_

  - [x] 2.2 MemoryEntryデータクラスの実装
    - MemoryEntryデータクラスを定義し、to_dict()とfrom_dict()メソッドを実装
    - JSON形式でのタグとキーワードのシリアライゼーション/デシリアライゼーション機能を実装
    - _要件: 1.1, 1.2, 1.3_

- [x] 3. データアクセス層の実装
  - [x] 3.1 MemoryServiceクラスの基本CRUD操作
    - MemoryServiceクラスを作成し、SQLiteデータベース接続管理を実装
    - add_memory、get_memory_by_id、update_memory、delete_memoryメソッドを実装
    - _要件: 1.1, 3.1, 3.2, 3.3_

  - [x] 3.2 検索機能の実装
    - search_memoriesメソッドを実装し、キーワードとタグによる検索機能を追加
    - list_all_memoriesメソッドを実装し、メタデータ付きの全エントリ取得機能を追加
    - _要件: 2.1, 2.2, 2.3_

- [x] 4. エラーハンドリングシステムの実装
  - カスタム例外クラス（NotFoundError、ValidationError、DatabaseError）を定義
  - エラーレスポンス形式の標準化とログ記録機能を実装
  - _要件: 3.4, 7.3_

- [x] 5. MCPツールの実装
  - [x] 5.1 基本的なメモリ操作ツール
    - add_note_to_memoryツールを実装し、コンテンツ、タグ、キーワード、要約の保存機能を追加
    - search_memoryツールを実装し、クエリとタグによる検索機能を追加
    - _要件: 4.3, 4.4_

  - [x] 5.2 高度なメモリ操作ツール
    - update_memory_entryとdelete_memory_entryツールを実装
    - list_all_memoriesとget_project_rulesツールを実装
    - _要件: 4.2, 3.1, 3.2, 3.3_

- [x] 6. REST APIエンドポイントの実装
  - [x] 6.1 メモリエントリCRUDエンドポイント
    - POST /memories、GET /memories/{id}、PUT /memories/{id}、DELETE /memories/{id}エンドポイントを実装
    - リクエスト/レスポンスのバリデーションとシリアライゼーションを実装
    - _要件: 1.1, 2.3, 3.1, 3.2, 3.3_

  - [x] 6.2 検索とフィルタリングエンドポイント
    - GET /memories、GET /memories/search、GET /memories/tags/{tag}エンドポイントを実装
    - クエリパラメータによる検索とフィルタリング機能を実装
    - _要件: 2.1, 2.2, 2.4_

- [x] 7. MCPサーバーの統合とプロトコル実装
  - FastMCPサーバーの初期化とツール登録を実装
  - MCPプロトコルに準拠したエラーハンドリングとレスポンス形式を実装
  - _要件: 4.1, 4.2_

- [x] 8. サーバー起動とライフサイクル管理
  - main関数を実装し、MCPサーバーとFastAPIサーバーの同時起動機能を追加
  - 設定管理とログ設定を実装
  - _要件: 6.4, 7.1, 7.3_

- [-] 9. 単体テストの実装
  - [x] 9.1 データアクセス層のテスト
    - MemoryServiceクラスの各メソッドに対する単体テストを作成
    - インメモリSQLiteデータベースを使用したテストフィクスチャを実装
    - _要件: 1.1, 1.4, 2.1, 2.2, 3.1, 3.2, 3.3_

  - [x] 9.2 MCPツールのテスト
    - 各MCPツールの動作を検証する単体テストを作成
    - エラーケースとエッジケースのテストを実装
    - _要件: 4.1, 4.2, 4.3, 4.4_

- [x] 10. 統合テストの実装
  - [x] 10.1 REST APIエンドポイントのテスト
    - FastAPIのTestClientを使用したAPIエンドポイントのテストを作成
    - リクエスト/レスポンスの形式とステータスコードの検証を実装
    - _要件: 2.3, 3.4, 7.3_

  - [x] 10.2 MCPプロトコル統合テスト
    - MCPクライアントとサーバー間の通信テストを作成
    - プロトコル準拠性とエラーハンドリングの検証を実装
    - _要件: 4.1, 7.3_

- [x] 11. ドキュメントとセットアップの完成
  - README.mdファイルを作成し、インストール手順と使用方法を記述
  - プロジェクト構造の最終確認とコードの整理を実行
  - _要件: 6.1, 6.3_