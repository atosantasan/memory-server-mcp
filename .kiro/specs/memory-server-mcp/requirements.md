# 要件定義書

## 概要

このプロジェクトは、長時間の会話におけるコンテキスト喪失問題を解決するため、MCP（Model Context Protocol）を通じてCursor/Claudeと統合する個人用メモリサーバーを作成することを目的としています。システムはLLMに長期記憶機能を提供し、保存された情報を能動的に参照・活用することで、より一貫性があり効率的な開発支援を実現します。

## 要件

### 要件1

**ユーザーストーリー:** Cursorを使用する開発者として、プロジェクト情報と決定事項を永続的なメモリシステムに保存したい。これにより、LLMが長時間の会話やセッション間でコンテキストを維持できるようになる。

#### 受け入れ基準

1. WHEN ユーザーがテキスト情報を入力する THEN システムは オプションのタグ付きでメモリエントリとして保存する
2. WHEN メモリを保存する THEN システムは 「目的」「ルール」「決定事項」「コードスニペット」「知識」などのタグで分類を可能にする
3. WHEN メモリを保存する THEN システムは キーワードと短い要約の追加を可能にする
4. WHEN サーバーが再起動する THEN システムは 以前に保存されたすべてのメモリデータを保持する

### 要件2

**ユーザーストーリー:** 開発者として、保存されたメモリを検索・取得したい。これにより、必要な時に関連情報にアクセスできるようになる。

#### 受け入れ基準

1. WHEN キーワードで検索する THEN システムは 関連するメモリエントリを返す
2. WHEN タグで検索する THEN システムは 一致するタグを持つすべてのエントリを返す
3. WHEN メモリリストを要求する THEN システムは メタデータと共にすべての保存されたメモリを表示する
4. WHEN 一致するものが見つからない THEN システムは 空の結果セットを返す

### 要件3

**ユーザーストーリー:** 開発者として、メモリエントリを更新・削除したい。これにより、正確で最新の情報を維持できるようになる。

#### 受け入れ基準

1. WHEN メモリエントリを更新する THEN システムは エントリIDを保持しながら内容を変更する
2. WHEN タグやキーワードを更新する THEN システムは 既存のメタデータを置き換える
3. WHEN メモリエントリを削除する THEN システムは ストレージから永続的に削除する
4. WHEN 存在しないエントリの更新・削除を試行する THEN システムは 適切なエラーメッセージを返す

### 要件4

**ユーザーストーリー:** LLM（Claude）として、MCPツールを通じてメモリ機能にアクセスしたい。これにより、保存された情報を応答で能動的に使用できるようになる。

#### 受け入れ基準

1. WHEN MCPサーバーが開始する THEN システムは MCPプロトコルに従ってメモリツールを公開する
2. WHEN LLMがget_project_rulesツールを呼び出す THEN システムは 関連するルールタグ付きメモリを返す
3. WHEN LLMがadd_note_to_memoryツールを呼び出す THEN システムは 指定されたタグと共に提供された内容を保存する
4. WHEN LLMがコンテキストを検索する THEN システムは 現在の会話トピックに関連するメモリを返す

### 要件5

**ユーザーストーリー:** LLMとして、会話コンテキストに基づいて関連するメモリを自動的に参照したい。これにより、より一貫性があり情報に基づいた応答を提供できるようになる。

#### 受け入れ基準

1. WHEN ユーザー入力を分析する THEN システムは 関連するキーワードとトピックを識別する
2. WHEN 関連するメモリが存在する THEN LLMは 自動的にそれらを応答に組み込む
3. WHEN ユーザーのコードや要求が保存されたルールと矛盾する THEN LLMは 積極的に修正を提案する
4. WHEN 提案を提供する THEN LLMは アドバイスの根拠となる特定のメモリエントリを参照する

### 要件6

**ユーザーストーリー:** 開発者として、軽量で持ち運び可能なシステムが欲しい。これにより、ローカルで簡単に実行でき、マシン間で移動できるようになる。

#### 受け入れ基準

1. WHEN システムをインストールする THEN システムは Pythonとライブラリのみを必要とする
2. WHEN サーバーを実行する THEN システムは 最小限のシステムリソースを使用する
3. WHEN 別のマシンに移動する THEN システムは SQLiteデータベースファイルとコードをコピーするだけで動作する
4. WHEN サーバーを開始する THEN システムは 外部依存関係なしで単一プロセスとして実行する

### 要件7

**ユーザーストーリー:** 開発者として、安定してセキュアなローカルシステムが欲しい。これにより、データがプライベートに保たれ、システムが信頼性高く動作するようになる。

#### 受け入れ基準

1. WHEN システムが動作する THEN システムは 外部ネットワークアクセスなしでlocalhost上で完全に実行する
2. WHEN データを保存する THEN システムは 信頼性の高いローカル永続化のためにSQLiteを使用する
3. WHEN エラーを処理する THEN システムは 明確なエラーメッセージを提供し、安定性を維持する
4. WHEN APIにアクセスする THEN システムは 速度よりも安定性を優先した一貫した応答時間を提供する