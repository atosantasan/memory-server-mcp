
# 自作メモリサーバー計画：個人利用・ローカル運用特化版

## 1. プロジェクトの目的

Cursor（Claude）との対話において発生する、以下のコンテキスト喪失問題を解決します。

* チャット履歴の長期化による、プロジェクトの**初期目的や基本ルールの見失い**。
* 過去の重要な決定事項や合意内容の**埋没**。
* LLM（Claude）がコンテキストを見失い、出力の**精度や一貫性が低下**する問題。

自作メモリサーバーを構築し、LLMが能動的に参照・活用できる**「長期記憶」**を提供することで、これらの課題を解決し、より効率的で一貫性のある開発支援を実現します。

## 2. 想定されるユーザーと利用シーン

* **ユーザー**: Cursorを利用してプログラミングや開発作業を行う**個人開発者**。
* **利用シーン**:
    * プロジェクトの立ち上げ時、基本的な**設計原則や技術スタック**をLLMに共有。
    * コーディング中に、特定の**コーディング規約や設計パターン**をLLMにリマインドさせる。
    * 過去の議論で決まった**仕様変更や機能追加の経緯**をLLMに参照させる。
    * デバッグ中に、**既知のバグパターンとその解決策**をLLMに提示させる。
    * 長期にわたるプロジェクトで、LLMが常に最新の**プロジェクト状況や目標**を把握している状態を維持する。

## 3. 主要機能要件

### 3.1. メモリのCRUD操作

* **作成 (Create)**:
    * ユーザーがテキスト形式で情報を入力し、メモリとして保存できる。
    * 保存時に、情報の種類（例: `目的`, `ルール`, `決定事項`, `コードスニペット`, `知識` など）を**タグ付け**できる。
    * 必要に応じて、関連するキーワードや短い要約を付加できる。
* **読み取り (Read)**:
    * LLMが特定のキーワードやタグに基づいてメモリを検索し、取得できる。
    * ユーザーが手動でメモリの内容を一覧表示したり、検索したりできる。
* **更新 (Update)**:
    * 既存のメモリ内容を編集できる。
    * メモリのタグやキーワードを更新できる。
* **削除 (Delete)**:
    * 不要になったメモリを削除できる。

### 3.2. LLM連携機能

* **ツール提供**: MCP（Model Context Protocol）に準拠した形式で、LLMが利用できる**「ツール」**としてメモリ操作機能を提供する。
    * 例: `get_project_rules(topic: str)`, `add_note_to_memory(content: str, tags: list[str])` など。
* **能動的な参照**: LLMが現在のチャットコンテキストに基づいて、関連性の高いメモリを**自動的に検索し、自身の応答に活用**できる仕組み。
* **リマインド機能**: LLMがユーザーの入力や生成コードが、メモリ内のルールや目的に反している場合に、**能動的に指摘・提案**できる。

### 3.3. データ永続化

* サーバーの再起動後もデータが失われないように、メモリ内容を**永続的に保存**する。
* **SQLite**（単一ファイルで管理）を必須とし、持ち運びやすさを確保する。

## 4. 非機能要件

* **無料での運用**: 基本的に**無料**で構築・運用できること（ローカルPCのみ）。
* **コンパクトさ**:
    * **単体起動**: 外部の複雑な依存関係を極力減らし、Pythonと必要なライブラリだけで起動できること。
    * **軽量性**: リソース消費が少なく、比較的スペックの低いPCでも快適に動作すること。
* **持ち運びやすさ**: SQLiteのDBファイルを含め、関連ファイルを一式まとめて別のPCへ**簡単に移動できる**こと。
* **レスポンス**: 高速なレスポンスよりも、**安定した動作と使いやすさ**を優先する。
* **セキュリティ**: ローカル運用のため、初期段階では簡易的で良い。
* **拡張性**: 将来的に機能追加（例: ベクトル検索、ファイル連携）が容易であること。

## 5. 推奨技術スタック

* **開発言語**: **Python** (クロスプラットフォーム、SQLite連携が容易)
* **Webフレームワーク**: **FastAPI** (軽量、高速、API定義がシンプル)
* **ASGIサーバー**: **Uvicorn** (FastAPIを動作させる軽量サーバー)
* **MCPライブラリ**: **FastMCP** (MCPプロトコル実装を簡素化)
* **データベース**: **SQLite3** (Python標準ライブラリ、単一ファイル、インストール不要、軽量)

## 6. 開発ステップ（提案）

1.  **環境構築**: Python、仮想環境のセットアップ。
2.  **ライブラリインストール**: `FastAPI`, `Uvicorn`, `FastMCP` をインストール。
3.  **データベーススキーマ設計**: SQLiteデータベース内にメモリ保存用のテーブル構造を設計。
4.  **CRUD操作の実装**: Pythonの`sqlite3`モジュールを使用し、メモリの保存、取得、更新、削除ロジックを実装。
5.  **FastAPIによるAPIエンドポイントの作成**: 実装したCRUD操作をHTTP APIとして公開。
6.  **FastMCPによるMCPツールの定義**: APIをMCPツールとしてラップし、Claudeが呼び出せるように定義。
7.  **サーバー起動スクリプトの作成**: `uvicorn`コマンドを直接実行できる、シンプルなPythonスクリプトを用意。
8.  **Cursorへの登録とテスト**: ローカルでサーバーを起動し、Cursorに登録して実際にチャットでメモリ機能が利用できるか検証。
9.  **リファクタリングと機能拡張**: 効果を確認しながら、必要に応じてベクトル検索の導入などを検討。


